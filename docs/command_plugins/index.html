<!DOCTYPE html>
<html lang="en-US" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.57.2" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/docs-dop/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/docs-dop/images/favicon.png" type="image/x-icon" />
    <title>Command Plugins :: DOP Deploment Orchestrator for Puppet</title>
    
    
    <link href="/docs-dop/css/nucleus.css?1567595497" rel="stylesheet">
    <link href="/docs-dop/css/font-awesome.min.css?1567595497" rel="stylesheet">
    <link href="/docs-dop/css/hybrid.css?1567595497" rel="stylesheet">
    <link href="/docs-dop/css/featherlight.min.css?1567595497" rel="stylesheet">
    <link href="/docs-dop/css/perfect-scrollbar.min.css?1567595497" rel="stylesheet">
    <link href="/docs-dop/css/auto-complete.css?1567595497" rel="stylesheet">
    <link href="/docs-dop/css/theme.css?1567595497" rel="stylesheet">
    <link href="/docs-dop/css/hugo-theme.css?1567595497" rel="stylesheet">
    

    <script src="/docs-dop/js/jquery-2.x.min.js?1567595497"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/docs-dop/command_plugins/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://swisscom.github.io/docs-dop">
  <strong>DOP</strong>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/docs-dop/js/lunr.min.js?1567595497"></script>
<script type="text/javascript" src="/docs-dop/js/auto-complete.js?1567595497"></script>
<script type="text/javascript">
    
        var baseurl = '\/docs-dop\/';
    
</script>
<script type="text/javascript" src="/docs-dop/js/search.js?1567595497"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/docs-dop/plan/" title="Plan" class="dd-item 
        
        
        
        ">
      <a href="/docs-dop/plan/">
          Plan
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/plan/pre_processor/" title="Pre-processor" class="dd-item ">
        <a href="/docs-dop/plan/pre_processor/">
        Pre-processor
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/plan/global_settings/" title="Global Settings" class="dd-item ">
        <a href="/docs-dop/plan/global_settings/">
        Global Settings
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/plan/credentials/" title="Credentials" class="dd-item ">
        <a href="/docs-dop/plan/credentials/">
        Credentials
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/plan/hooks/" title="Hooks" class="dd-item ">
        <a href="/docs-dop/plan/hooks/">
        Hooks
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/plan/infrastructures/" title="Infrastructures" class="dd-item ">
        <a href="/docs-dop/plan/infrastructures/">
        Infrastructures
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/plan/nodes/" title="Nodes" class="dd-item ">
        <a href="/docs-dop/plan/nodes/">
        Nodes
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/plan/configuration/" title="Configuration" class="dd-item ">
        <a href="/docs-dop/plan/configuration/">
        Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/plan/steps/" title="Steps" class="dd-item ">
        <a href="/docs-dop/plan/steps/">
        Steps
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs-dop/command_plugins/" title="Command Plugins" class="dd-item 
        parent
        active
        
        ">
      <a href="/docs-dop/command_plugins/">
          Command Plugins
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/command_plugins/custom/" title="custom" class="dd-item ">
        <a href="/docs-dop/command_plugins/custom/">
        custom
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/command_plugins/ssh/custom/" title="ssh/custom" class="dd-item ">
        <a href="/docs-dop/command_plugins/ssh/custom/">
        ssh/custom
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/command_plugins/ssh/puppet_agent_run/" title="ssh/puppet_agent_run" class="dd-item ">
        <a href="/docs-dop/command_plugins/ssh/puppet_agent_run/">
        ssh/puppet_agent_run
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/command_plugins/winrm/puppet_agent_run/" title="winrm/puppet_agent_run" class="dd-item ">
        <a href="/docs-dop/command_plugins/winrm/puppet_agent_run/">
        winrm/puppet_agent_run
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/command_plugins/overview/" title="Overview" class="dd-item ">
        <a href="/docs-dop/command_plugins/overview/">
        Overview
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs-dop/overview/" title="Overview" class="dd-item 
        
        
        
        ">
      <a href="/docs-dop/overview/">
          Overview
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/overview/about/" title="About" class="dd-item ">
        <a href="/docs-dop/overview/about/">
        About
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs-dop/overview/architecture/" title="Architecture" class="dd-item ">
        <a href="/docs-dop/overview/architecture/">
        Architecture
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            <a href='/docs-dop/'>DOP Deploment Orchestrator for Puppet</a> > Command Plugins
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#credentials-for-login">credentials for login</a>
<ul>
<li><a href="#plugin-defaults">Plugin Defaults</a></li>
<li><a href="#set-plugin-defaults-optional">set_plugin_defaults (optional)</a></li>
<li><a href="#delete-plugin-defaults">delete_plugin_defaults</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Command Plugins</h1>
          

        




<p>Command plugins are some simple pieces of code which allow you to do certain actions or check certain things on a node.</p>

<p>Each plugin uses a specific connector to connect to a node and execute the commands. This is specified by the fist part
of the command plugin name, the second part is the name of the function: connector/function</p>

<p>DOP does not aspire to be a configuration management tool on its own and therefor the amount of plugins and possibilities
are somewhat limited. The idea is to give you the tools to run puppet in the right order and maybe place or change some
needed files to make sure the node can connect to the master.</p>

<p>There are currently three supported connectors: winrm, ssh and mcollective.</p>

<p>Winrm and ssh both use the credentials hash for authentication. For Mcollective you need to point to the mco configuration
file in your dop configuration file.</p>

<h2 id="credentials-for-login">credentials for login</h2>

<p>The plugins which use the ssh and winrm connector can use credentials from the credentials hash in the plan to login.
More information about the credentials hash itself can be found in the plan chapter under credentials.</p>

<p>Here is a simple example of a ssh username/password login</p>

<pre><code>credentials:
  'linux_staging_login':
    type: :username_password
    username: 'root'
    password: 'foo'

steps:
  - name: 'set ssh login credentials'
    command:
      plugin: 'ssh/custom'
      credentials: 'linux_staging_login'
      exec: 'env'
</code></pre>

<p>You can also specify multiple credentials and the connectors will try each one
of them in turn to login to the node.</p>

<pre><code>credentials:
  'linux_staging_login':
    type: :username_password
    username: 'root'
    password: 'foo'
  'linux_prod_login':
    type: :ssh_key
    private_key: '/home/root/.ssh/id_dsa'

steps:
  - name: 'set ssh login credentials'
    command:
      plugin: 'ssh/custom'
      credentials:
        - 'linux_staging_login'
        - 'linux_prod_login'
      exec: 'env'
</code></pre>

<p>This can be set in each plugin (don&rsquo;t forget the validator plugins) or via
the set_plugin_defaults hash. The plugin defaults will be preserved for
subsequent steps until it is altered or deleted. More about this feature in the next section.</p>

<pre><code>credentials:
  'linux_staging_login':
    type: :username_password
    username: 'root'
    password: 'foo'
  'linux_prod_login':
    type: :ssh_key
    private_key: '/home/root/.ssh/id_dsa'

steps:
  - name: 'set ssh login credentials'
    set_plugin_defaults:
      - plugins: '/^ssh/'
        :credentials:
          - 'linux_staging_login'
          - 'linux_prod_login'
    command:
      plugin: 'ssh/custom'
      exec: 'env'
</code></pre>

<p>The login via password for the ssh connector will need the program sshpass to be installed on the
machine DOPi is running on. DOPi will display a warning if you specify a username password credential
but sshpass is not installed.</p>

<h3 id="plugin-defaults">Plugin Defaults</h3>

<p>Sometimes you have some settings, like the credentials settings for connectors for example, which you
have to specify on every single plugin. To make this easier you can set plugin defaults.</p>

<p>The defaults will be active from the step where you specified for all following steps. They can then be
overwritten in later steps by explicitely defining the setting or by defining new defaults. It is also
possible to remove the defaults again.</p>

<h3 id="set-plugin-defaults-optional">set_plugin_defaults (optional)</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Allowed Values</th>
<th>Default</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>set_plugin_defaults</td>
<td>Array</td>
<td>nil</td>
<td>0.4</td>
</tr>
</tbody>
</table>

<p>With &ldquo;set_plugin_defaults&rdquo; it is possible to specify some default values for plugin configuration which will persist
over subsequent runs.</p>

<p>The settings are node specific, so they will only be set for the nodes in your step. You can select the plugins for which
this applies with a list or with regular expressions.</p>

<p>Direct settings in the plugins will always overwrite the defaults.</p>

<p>Example:</p>

<pre><code>steps:
  - name: &quot;Set default passwords for Plugins&quot;
    nodes: all
    set_plugin_defaults:
      - plugins: '/^ssh/'
        :credentials: 'linux_staging_password'
      - plugins: '/^winrm/'
        :credentials: 'windows_staging_password'
      - plugins:
        - 'ssh/custom'
        :quiet: false
</code></pre>

<div class="notices info" >
The keys you want to set have to be ruby symbols. This is a current limitation of the way the parser is
implemented and may change in the future
</div>

<h3 id="delete-plugin-defaults">delete_plugin_defaults</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Allowed Values</th>
<th>Default</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>delete_plugin_defaults</td>
<td>Array</td>
<td>nil</td>
<td>0.4</td>
</tr>
</tbody>
</table>

<p>There are several possibilities how you can remove plugin settings with &ldquo;delete_plugin_defaults&rdquo;</p>

<p>Example:</p>

<pre><code>steps:
  - name: &quot;Remove some specific defaults for all nodes&quot;
    nodes: all
    delete_plugin_defaults:
      - plugins: '/^ssh/'
        delete_keys:
          - :credentials
          - :timeout

  - name: &quot;Remove all the defaults for the ssh plugins for all nodes in role 'foo'&quot;
    roles:
      - foo
    delete_plugin_defaults:
      - plugins: '/^ssh/'
        delete_keys: all

  - name: &quot;Remove all the defaults for all plugins for all nodes&quot;
    nodes: all
    delete_plugin_defaults: all
</code></pre>

<div class="notices info" >
The keys you want to set have to be ruby symbols. This is a current limitation of the way the parser is
implemented and may change in the future
</div>


<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/docs-dop/plan/steps/" title="Steps"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/docs-dop/command_plugins/custom/" title="custom" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docs-dop/js/clipboard.min.js?1567595497"></script>
    <script src="/docs-dop/js/perfect-scrollbar.min.js?1567595497"></script>
    <script src="/docs-dop/js/perfect-scrollbar.jquery.min.js?1567595497"></script>
    <script src="/docs-dop/js/jquery.sticky.js?1567595497"></script>
    <script src="/docs-dop/js/featherlight.min.js?1567595497"></script>
    <script src="/docs-dop/js/html5shiv-printshiv.min.js?1567595497"></script>
    <script src="/docs-dop/js/highlight.pack.js?1567595497"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docs-dop/js/modernizr.custom.71422.js?1567595497"></script>
    <script src="/docs-dop/js/learn.js?1567595497"></script>
    <script src="/docs-dop/js/hugo-learn.js?1567595497"></script>

    <link href="/docs-dop/mermaid/mermaid.css?1567595497" type="text/css" rel="stylesheet" />
    <script src="/docs-dop/mermaid/mermaid.js?1567595497"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
