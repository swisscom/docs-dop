<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.20" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />

    
    <title>winrm/puppet_agent_run</title>
    <link href="https://swisscom.github.io/docs-dop//css/nucleus.css" rel="stylesheet">
    <link href="https://swisscom.github.io/docs-dop//css/font-awesome.min.css" rel="stylesheet">
    <link href="https://swisscom.github.io/docs-dop//css/hybrid.css" rel="stylesheet">
    <link href="https://swisscom.github.io/docs-dop//css/featherlight.min.css" rel="stylesheet">
    <link href="https://swisscom.github.io/docs-dop//css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="https://swisscom.github.io/docs-dop//css/horsey.css" rel="stylesheet">
    <link href="https://swisscom.github.io/docs-dop//css/theme.css" rel="stylesheet">
    <link href="https://swisscom.github.io/docs-dop//css/hugo-theme.css" rel="stylesheet">
    <script src="https://swisscom.github.io/docs-dop//js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    

  </head>
  <body class="" data-url="/docs-dop/command_plugins/winrm/puppet_agent_run/">
    
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://swisscom.github.io/docs-dop">
  <strong>DOP</strong>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input id="search-by" type="text" placeholder="Search">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="https://swisscom.github.io/docs-dop//js/lunr.min.js"></script>
<script type="text/javascript" src="https://swisscom.github.io/docs-dop//js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "https:\/\/swisscom.github.io\/docs-dop\/";
</script>
<script type="text/javascript" src="https://swisscom.github.io/docs-dop//js/search.js"></script>

    
</div>


  <div class="highlightable">
    <ul class="topics">
      
        
        
          
          
            
          
        
          
          
            
          
        
          
          
            
          
        
        
        
          
        
          
        
          
        
      
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  " data-nav-id="/docs-dop/overview/">
        <a href="/docs-dop/overview/">
          <span>
            
              <b>1. </b>
            
             Overview
            
           </span>
        </a>
        
        <ul>
          
            <li class="dd-item " data-nav-id="/docs-dop/overview/about/">
              <a href="/docs-dop/overview/about/">
                <span>About     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/overview/architecture/">
              <a href="/docs-dop/overview/architecture/">
                <span>Architecture     </i></span>
              </a>
            </li>
          
        </ul>
        
      </li>
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  " data-nav-id="/docs-dop/plan/">
        <a href="/docs-dop/plan/">
          <span>
            
              <b>2. </b>
            
             Plan
            
           </span>
        </a>
        
        <ul>
          
            <li class="dd-item " data-nav-id="/docs-dop/plan/pre_processor/">
              <a href="/docs-dop/plan/pre_processor/">
                <span>Pre-processor     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/plan/global_settings/">
              <a href="/docs-dop/plan/global_settings/">
                <span>Global Settings     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/plan/credentials/">
              <a href="/docs-dop/plan/credentials/">
                <span>Credentials     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/plan/hooks/">
              <a href="/docs-dop/plan/hooks/">
                <span>Hooks     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/plan/infrastructures/">
              <a href="/docs-dop/plan/infrastructures/">
                <span>Infrastructures     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/plan/nodes/">
              <a href="/docs-dop/plan/nodes/">
                <span>Nodes     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/plan/configuration/">
              <a href="/docs-dop/plan/configuration/">
                <span>Configuration     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/plan/steps/">
              <a href="/docs-dop/plan/steps/">
                <span>Steps     </i></span>
              </a>
            </li>
          
        </ul>
        
      </li>
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  parent" data-nav-id="/docs-dop/command_plugins/">
        <a href="/docs-dop/command_plugins/">
          <span>
            
              <b>3. </b>
            
             Command Plugins
            
           </span>
        </a>
        
        <ul>
          
            <li class="dd-item " data-nav-id="/docs-dop/command_plugins/overview/">
              <a href="/docs-dop/command_plugins/overview/">
                <span>Overview     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/command_plugins/custom/">
              <a href="/docs-dop/command_plugins/custom/">
                <span>custom     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/command_plugins/ssh/custom/">
              <a href="/docs-dop/command_plugins/ssh/custom/">
                <span>ssh/custom     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/docs-dop/command_plugins/ssh/puppet_agent_run/">
              <a href="/docs-dop/command_plugins/ssh/puppet_agent_run/">
                <span>ssh/puppet_agent_run     </i></span>
              </a>
            </li>
          
            <li class="dd-item active" data-nav-id="/docs-dop/command_plugins/winrm/puppet_agent_run/">
              <a href="/docs-dop/command_plugins/winrm/puppet_agent_run/">
                <span>winrm/puppet_agent_run     </i></span>
              </a>
            </li>
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
     
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                  
                  
                  
                    
                    
                <a href="/docs-dop/command_plugins/" itemprop="url"><span itemprop="title">Command Plugins</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                <span itemprop="title"> winrm/puppet_agent_run</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#plugin-parameters">Plugin Parameters</a></li>
<li><a href="#connector-parameters">Connector Parameters</a></li>
<li><a href="#examples">Examples:</a>
<ul>
<li><a href="#simple-example">Simple Example</a></li>
<li><a href="#complete-example">Complete Example</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
              <div id="body-inner">
                
                <h1>winrm/puppet_agent_run</h1>
                



<p>This plugin runs puppet on a node and features some important workarounds for common
problems encountered when doing so, like waiting if a run is already in progress or
doing reruns on errors if configured.</p>

<table>
<thead>
<tr>
<th>Plugin Name</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>winrm/puppet_agent_run</td>
<td>0.13.0</td>
</tr>
</tbody>
</table>

<h2 id="plugin-parameters">Plugin Parameters</h2>

<p><h3 id="rerun-on-change-optional">rerun_on_change (optional)</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Allowed Values</th>
<th>Default</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>rerun_on_change</td>
<td>true,false</td>
<td>false</td>
<td>0.18.0</td>
</tr>
</tbody>
</table>

<p>If the return code of puppet indicates that there where changes the plugin
will do a rerun.</p>

<p>The purpose of this setting is to allow an easy workaround if the puppet catalog
needs to run multiple times to fully reach the desired state. Usually this should
be fixed in the puppet code and DOPi will display a warning if multiple reruns are
required. Make sure you also set the max_rerun to allow for the desired amount of
reruns.</p>

<h3 id="rerun-on-error-optional">rerun_on_error (optional)</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Allowed Values</th>
<th>Default</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>rerun_on_error</td>
<td>true,false</td>
<td>false</td>
<td>0.18.0</td>
</tr>
</tbody>
</table>

<p>Similar to rerun_on_change, this setting allows for automatic reruns of puppet
if the return value of the agent indicates that there where errors in the Puppet
run or if there where error messages during the run.</p>

<p>The purpose of this setting is to allow an easy workaround if there are for example
still ordering errors on the catalog and a rerun will reach the desired state.
DOPi will in all cases display a warning to indicate that a rerun happened.</p>

<h3 id="max-rerun-optional">max_rerun (optional)</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Allowed Values</th>
<th>Default</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>max_rerun</td>
<td>&gt; 0</td>
<td>1</td>
<td>0.18.0</td>
</tr>
</tbody>
</table>

<p>The maximum amount of puppet reruns the plugin will do if either &lsquo;rerun_on_error&rsquo; or
&lsquo;rerun_on_change&rsquo; is true.</p>

<h3 id="wait-if-already-running-optional">wait_if_already_running (optional)</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Allowed Values</th>
<th>Default</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>wait_if_already_running</td>
<td>true,false</td>
<td>true</td>
<td>0.18.0</td>
</tr>
</tbody>
</table>

<p>If true, the plugin will wait if puppet is already running on the instance. This is
often the case if puppet runs as part of the deployment or if the agent is running
in daemon mode.

<h3 id="arguments-optional">arguments (optional)</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Allowed Values</th>
<th>Default</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>arguments</td>
<td>String,Hash,Array</td>
<td>&rdquo;&rdquo;</td>
<td>0.1</td>
</tr>
</tbody>
</table>

<p>The arguments for the command. This can be set by a string as an array or
as a hash. All the elements of the hash and the array will be flattened
and joined with a space.</p>

<p>The following examples will result all in the same arguments string:</p>

<pre><code>arguments: &quot;--name foo -s somearg&quot;

arguments:
  '--name': 'foo'
  '-s':
  'somearg':

arguments:
  - '--name foo'
  - '-s'
  - 'somearg'
</code></pre>


<h3 id="env-optional">env (optional)</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Allowed Values</th>
<th>Default</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>arguments</td>
<td>Hash</td>
<td>{ DOP_NODE_FQDN =&gt; fqdn_of_node }</td>
<td>0.1</td>
</tr>
</tbody>
</table>

<p>The environment variables that should be set in the context of the command. Additional
variables can be defined in a hash which will be merged with the default.</p>

<p>Example:</p>

<pre><code>env:
  PATH: '/usr/bin:/bin'
  FOO:  'bar'
</code></pre>


<h3 id="parse-output-optional">parse_output (optional)</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Allowed Values</th>
<th>Default</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>parse_output</td>
<td>Hash</td>
<td>{}</td>
<td>0.1</td>
</tr>
</tbody>
</table>

<p>Here you can define patterns that match against the output of the command plugin
and flag certain lines as errors or warnings. The parse_output key should contain
a hash with two keys, &lsquo;error&rsquo; and &lsquo;warning&rsquo; which each can contain an array of
regular expressions.</p>

<p>To for example flag all lines starting with &ldquo;Error:&rdquo; as errors define:</p>

<pre><code>parse_output:
  error:
    - &quot;^Error&quot;
</code></pre>

<h3 id="fail-on-warning-optional">fail_on_warning (optional)</h3>

<table>
<thead>
<tr>
<th>Key</th>
<th>Allowed Values</th>
<th>Default</th>
<th>Since Version</th>
</tr>
</thead>

<tbody>
<tr>
<td>fail_on_warning</td>
<td>true,false</td>
<td>false</td>
<td>0.1</td>
</tr>
</tbody>
</table>

<p>Set this to true if you want to threat warnings in the output as errors. This is
useful if the plugin already specifies the parsing patterns but your need to stop
the run on warnings.
</p>

<h2 id="connector-parameters">Connector Parameters</h2>

<p>TBD
</p>

<h2 id="examples">Examples:</h2>

<h3 id="simple-example">Simple Example</h3>

<pre><code>- name &quot;Run puppet in noop mode&quot;
  nodes:
    - 'web01.example.com'
  command:
    plugin: 'winrm/puppet_agent_run'
    arguments: '--noop'
</code></pre>

<h3 id="complete-example">Complete Example</h3>

<pre><code>- name &quot;Run Puppet until there are no errors and changes anymore&quot;
  nodes:
    - 'web01.example.com'
  command:
    plugin: 'winrm/puppet_agent_run'
    rerun_on_change: true
    rerun_on_error: true
    max_rerun: 10
</code></pre>


      
      
      </div>
    </div>

    

    <div id="navigation">
        
        
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://swisscom.github.io/docs-dop//js/clipboard.min.js"></script>
    <script src="https://swisscom.github.io/docs-dop//js/perfect-scrollbar.min.js"></script>
    <script src="https://swisscom.github.io/docs-dop//js/perfect-scrollbar.jquery.min.js"></script>
    <script src="https://swisscom.github.io/docs-dop//js/jquery.sticky-kit.min.js"></script>
    <script src="https://swisscom.github.io/docs-dop//js/featherlight.min.js"></script>
    <script src="https://swisscom.github.io/docs-dop//js/html5shiv-printshiv.min.js"></script>
    <script src="https://swisscom.github.io/docs-dop//js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://swisscom.github.io/docs-dop//js/modernizr.custom.71422.js"></script>
    <script src="https://swisscom.github.io/docs-dop//js/learn.js"></script>
    <script src="https://swisscom.github.io/docs-dop//js/hugo-learn.js"></script>
    

  </body>
</html>

